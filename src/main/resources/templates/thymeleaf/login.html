<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ShiroForbes</title>
    <link href="https://cdn.jsdelivr.net/npm/beercss@3.6.12/dist/cdn/beer.min.css" rel="stylesheet">
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.6.12/dist/cdn/beer.min.js"></script>
    <script type="module"
            src="https://cdn.jsdelivr.net/npm/material-dynamic-colors@1.1.2/dist/cdn/material-dynamic-colors.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/md5.js"></script>
    <link href="/static/styles/styles.css" rel="stylesheet">
</head>
<body>
<main class="responsive grid">
    <div class="s0 m2 l3"></div>
    <div class="s12 m8 l6">
        <article class="middle grid">
            <div class="s2"></div>

            <div class="s8">
                <form>
                    <div class="medium-space"></div>
                    <div class="center" th:insert="~{components/logo :: logo()}"></div>
                    <div class="medium-space"></div>
                    <div class="field label border">
                        <input name="login" id="login" type="text" required>
                        <label for="login">Login</label>
                    </div>
                    <div class="medium-space"></div>
                    <div class="field label border">
                        <input name="password" id="password" type="password" required>
                        <label for="password">Password</label>
                    </div>
                    <div class="medium-space"></div>
                    <button class="extra round center" id="signIn" type="submit">
                        <span id="span">Sign In</span>
                        <progress class="circle" id="progress" style="display: none"></progress>
                    </button>
                    <div class="medium-space"></div>
                </form>
            </div>

            <div class="s2"></div>
        </article>
    </div>
    <div class="s0 m2 s3"></div>
</main>
<script th:inline="javascript">
    const login = document.getElementById("login")
    const password = document.getElementById("password")
    const span = document.getElementById("span")
    const progress = document.getElementById("progress")
    const form = document.querySelector("form")


    form.addEventListener("submit", (e) => {
        e.preventDefault();
        const data = {
            "login": login.value,
            "password": CryptoJS.MD5(password.value).toString(CryptoJS.enc.Hex),
        }

        span.style.display = "none"
        progress.style.display = ""
        fetch("/login", {
            method: "POST",
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        }).then(response => {
            if (response.redirected) {
                window.location.assign(response.url)
            } else {
                span.style.display = ""
                progress.style.display = "none"
                alert("Неверный логин или пароль")
            }
        })
    })
</script>
</body>
</html>